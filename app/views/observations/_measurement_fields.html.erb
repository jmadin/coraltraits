<div class="nested-fields">

	<script>
	  var a = 0;
	  $(document).ready(function() {
	  		
	  		
			$('select.my_standard').select2();
			$('select.my_trait').select2();
			$('select.my_methodology').select2();
	    
	    $('.my_trait').change(function() {
	      $.ajax({
	        url: "update_values",
	        data: {
	        			element_id: $(this).attr('id'),
						trait_id: $(this).val()
						
					},
	        dataType: "script"
	      });
	    
	    });

	    $('.add_fields').click(function(e){
	    	 /*
	    	 e.preventDefault();
	    	 window.a = window.a + 1;
 		    console.log(window.a);
 		    var new_id = "my_trait" + window.a;
 		    $('#sur_trait').attr('id', new_id);
 		    */
	    });
	    
	  });
	</script>

	
	
  <div class="well">

    <%= f.hidden_field :user_id, :value => current_user.id %>
		

		<div class="row">
		  <div class="col-md-12">
			  <div class="form-group">
				  <%= f.label :trait %>
				  <%= @my_var %>
				  <% @temp_var = @temp_var + 1 %>
				  <% unique_trait_id = 'trait_select' + @temp_var.to_s %>
				  <% unique_value_id = 'trait_value' + @temp_var.to_s %>
				  <% unique_standard_id = 'trait_standard' + @temp_var.to_s %>
				  <% unique_suggested_standard_id = 'suggested_standard' + @temp_var.to_s %>
				  <% unique_methodology_id = 'trait_methodology' + @temp_var.to_s %>

					<br/>
					<% if !f.object.id %>
						<%= f.select :trait_id, Trait.all.map { |u| [u.trait_name, u.id] }, { include_blank: 'Choose trait...', class: "form-control" }, { id: "sur_trait", class: "my_trait" } %>
					<% else %>
						<%= f.select :trait_id, Trait.all.map { |u| [u.trait_name, u.id] }, { include_blank: 'Choose trait...', class: "form-control" }, { id: unique_trait_id, class: "my_trait" } %>
					<% end %>
				</div>
			</div>
		</div>

		<div class="row">
		  <div class="col-md-12" id="values_select">
				<%#= render 'values' %>
			</div>    
		</div>
		
		<div class="row">
		  <div class="col-md-6">
				<div class="form-group">
						<%= f.label :value %>
						<% if f.object.id %>
				  		<small class="pull-right">(originally entered as: <%= f.object.orig_value %>)</small>
						<% end %>
						<%# if !f.object.id %>
							<%# f.text_field :value, :placeholder => "Value", class: "form-control" %>
							<% if !f.object.id %>
								<%= f.select :value, [], { include_blank: 'Choose Value', class: "form-control" }, {id: "sur_value" } %>
								
							<% else %>
								<% if not f.object.trait.value_range.empty? %>
									<%= f.select :value, f.object.trait.value_range.split(','), { include_blank: 'Choose Value', class: "form-control" }, {id: unique_value_id } %>
								<% else %>
									<%= f.text_field :value, class: "form-control", id: unique_value_id %>	
								<% end %>
							<% end %>
							<%= f.hidden_field :orig_value, :value => params[:value] %>
						<%# else %>
							<%# f.text_field :value, class: "form-control" %>
						<%# end %>

					</div>
			</div>

			<div class="col-md-6">
				<div class="form-group">
						<%= f.label :value_type %>
						<%= f.select :value_type, ['raw_value', 'aggregate', 'model_derived', 'expert_opinion' , 'group_opinion'], { include_blank: 'Choose...' }, class: "form-control" %>
				</div>
			</div>

		</div>
		
		<div class="row">
		  <div class="col-md-6">
			  <div class="form-group">
				  <%= f.label :standard %>
					<br/>
					<%= f.select :standard_id, Standard.all.map { |u| ["#{u.standard_name} (#{u.standard_unit})", u.id] }, { include_blank: 'Choose standard...', class: "form-control" }, { id: "sur_standard", class: "my_standard" } %>
					<%#= f.select :standard_id, [], { include_blank: 'Choose standard...', class: "form-control" }, { id: unique_standard_id } %>

					<span id="<%= unique_suggested_standard_id %>" class="hidden"> Suggested standard: </span>
				</div>
			</div>
			<div class="col-md-6">
			  <div class="form-group">
				  <%= f.label :methodolgy_id %> <br/>
				  <% if !f.object.id %>
				  	<%= f.select :methodology_id, [], { include_blank: 'Choose Methodology', class: "form-control" }, {id: "sur_methodology" , class: "my_methodology"} %>
				  <% else %>
						<%= f.select :methodology_id, f.object.trait.methodologies.map { |m| [ m.methodology_name, m.id ]} , { include_blank: 'Choose Methodology', class: "form-control" }, {id: "sur_methodology" , class: "my_methodology"} %>
				  <% end %>
					<br/>
				</div>
			</div>
		</div>    
	  
      
		<div class="row">
		  <div class="col-md-6">
			  <div class="form-group">
				  <%= f.label :precision_type %>
				  <%#= f.text_field :precision_type, class: "form-control" %>
					<%= f.select :precision_type, ['standard_error', 'standard_deviation', '95_ci', 'range'], {:include_blank => "Choose if applicable..."}, class: "form-control" %>
				</div>
			</div>
			<div class="col-md-6">
			  <div class="form-group">
				  <%= f.label :precision %>
				  	<%= f.text_field :precision, class: "form-control" %>
				</div>
			</div>
		</div>
		
		<div class="row">
		  <div class="col-md-6">
			  <div class="form-group">
				  <%= f.label :precision_upper %>
				  	<%= f.text_field :precision_upper, class: "form-control" %>
				</div>
			</div>
			<div class="col-md-6">
			  <div class="form-group">
				  <%= f.label :replicates %>
				  	<%= f.text_field :replicates, class: "form-control" %>
				</div>
			</div>
		</div>

		<div class="row">
		  <div class="col-md-12">
			  <div class="form-group">
				  <%= f.label :notes %>
				  	<%= f.text_area :notes, class: "form-control" %>
				</div>
			</div>
		</div>

		<%= link_to_remove_association "remove", f %>

	</div>
</div>


